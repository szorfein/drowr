---
import { ChipsFilter } from "@drowr/licid";
import { getAllPosts } from "@/lib/client";

const data = await getAllPosts();
const allPosts = data.publication.posts.edges;

const allTags = allPosts.flatMap((post) => post.node.tags);
const allTagsName = allTags.map((tag) => tag.name);
const allTagsSlug = allTags.map((tag) => tag.slug);
const tags = [...new Set(allTagsName)];
const tagsSlug = [...new Set(allTagsSlug)];

const currentPath = new URL(Astro.request.url).pathname;
const pathSegments = currentPath
  .split("/")
  .filter((segment) => segment.length > 0);

const atest = (word) => {
  const currentTag = pathSegments[pathSegments.length - 1] || "";
  //console.log(currentTag);
  //console.log(word);
  return currentTag === word;
};
---

<div class="mb-12 flex flex-row flex-wrap justify-center gap-2">
  <ChipsFilter
    name="all"
    slug="/posts"
    isfocus={atest("posts") ? true : false}
  />
  {
    tags.map((t, i) => (
      <ChipsFilter
        name={t}
        slug={`/posts/${tagsSlug[i]}`}
        isfocus={atest(`${tagsSlug[i]}`) ? true : false}
      />
    ))
  }
</div>

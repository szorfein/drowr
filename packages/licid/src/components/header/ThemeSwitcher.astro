---
import IconDarkMode from "../../assets/icons/dark-mode.svg";
import ButtonIcon from "../button/IconStandard.astro";
---

<div id="theme-switcher">
  <ButtonIcon classes="mr-2" label="Theme colors switcher">
    <IconDarkMode
      width={24}
      height={24}
      fill="currentColor"
      class="fill-onSurfaceVariant dark:fill-dark-onSurfaceVariant"
    />
  </ButtonIcon>
</div>

<script>
  if (document.documentElement.classList.contains("mode-auto")) {
    const applyTheme = () => {
      if (
        localStorage.theme === "dark" ||
        (!("theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    };

    // toggle
    const setupThemeSwitcher = () => {
      const themeSwitcher = document.getElementById("theme-switcher");
      if (themeSwitcher) {
        themeSwitcher.addEventListener("click", () => {
          if (localStorage.theme === "dark") {
            localStorage.theme = "light";
            document.documentElement.classList.remove("dark");
          } else {
            localStorage.theme = "dark";
            document.documentElement.classList.add("dark");
          }
        });
      }
    };

    document.addEventListener("DOMContentLoaded", () => {
      applyTheme();
      setupThemeSwitcher();
    });
    document.addEventListener("astro:page-loaded", () => {
      applyTheme();
      setupThemeSwitcher();
    });
    // Runs on view transitions navigation
    document.addEventListener("astro:after-swap", () => {
      applyTheme();
      setupThemeSwitcher();
    });
  } else if (document.documentElement.classList.contains("mode-dark")) {
    document.documentElement.classList.add("dark");
  } else if (document.documentElement.classList.contains("mode-light")) {
    document.documentElement.classList.remove("dark");
  }
</script>
